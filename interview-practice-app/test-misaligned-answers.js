/**
 * ã‹ã¿åˆã‚ãªã„å›ç­”ã®ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
 * å®Ÿè£…ã•ã‚ŒãŸcheckAnswerAlignmenté–¢æ•°ã®å‹•ä½œã‚’ç¢ºèª
 */

// ãƒ†ã‚¹ãƒˆç”¨ã®é–¢æ•°ï¼ˆAPIã‹ã‚‰æŠ½å‡ºï¼‰
function checkAnswerAlignment(question, answer) {
  // è³ªå•ã®ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
  const questionTypes = {
    // æ™‚é–“ã‚’èã„ã¦ã„ã‚‹è³ªå•
    time: /ã©ã‚Œãã‚‰ã„|ä½•åˆ†|ä½•æ™‚é–“|æ™‚é–“|ã‹ã‹ã‚Šã¾ã—ãŸã‹/.test(question),
    // æ–¹æ³•ã‚’èã„ã¦ã„ã‚‹è³ªå•
    method: /ã©ã®ã‚ˆã†ã«|ã©ã†ã‚„ã£ã¦|ã©ã‚“ãªæ–¹æ³•|ã©ã†ã„ã†é¢¨ã«|ã©ã®ã‚ˆã†ãªæ–¹æ³•|æ–¹æ³•ã§/.test(question),
    // ç†ç”±ã‚’èã„ã¦ã„ã‚‹è³ªå•
    reason: /ãªãœ|ã©ã†ã—ã¦|ç†ç”±|ãã£ã‹ã‘/.test(question),
    // å›°é›£ã‚’èã„ã¦ã„ã‚‹è³ªå•
    difficulty: /å›°ã£ãŸ|å¤§å¤‰|é›£ã—ã‹ã£ãŸ|ã†ã¾ãã„ã‹ãª|å¤±æ•—/.test(question),
    // å…·ä½“ä¾‹ã‚’èã„ã¦ã„ã‚‹è³ªå•
    example: /ä¾‹ãˆã°|å…·ä½“çš„ã«|ã©ã‚“ãª|ä½•ã‹/.test(question),
    // äººç‰©ã‚’èã„ã¦ã„ã‚‹è³ªå•
    person: /èª°|å…ˆç”Ÿ|å‹é”|ä»²é–“|ä¸€ç·’/.test(question),
    // æ•°é‡ã‚’èã„ã¦ã„ã‚‹è³ªå•
    quantity: /ä½•äºº|ä½•å›|ä½•å€‹|ã„ãã¤/.test(question),
    // æ„Ÿæƒ³ãƒ»æ„Ÿæƒ…ã‚’èã„ã¦ã„ã‚‹è³ªå•
    feeling: /ã©ã†æ€|ã©ã†æ„Ÿã˜|æ°—æŒã¡|å°è±¡/.test(question)
  };

  // å›ç­”ã®å†…å®¹ãƒã‚§ãƒƒã‚¯
  const answerChecks = {
    // æ™‚é–“ã®å›ç­”ãŒã‚ã‚‹ã‹
    hasTime: /\d+åˆ†|\d+æ™‚é–“|åˆ†|æ™‚é–“|ã‹ã‹ã‚Š/.test(answer),
    // æ–¹æ³•ã®èª¬æ˜ãŒã‚ã‚‹ã‹ï¼ˆå…·ä½“çš„ãªè¡Œå‹•ã‚„æ‰‹é †ã‚’å«ã‚€ï¼‰
    hasMethod: /ä½¿ã£ã¦|ã—ã¦|ã™ã‚‹ã¨|ã‚ˆã†ã«|ã‚„ã‚Šæ–¹|æ‰‹é †|è©¦é¨“ç´™|é“å…·|å™¨å…·|æ¸¬å®šã—ã¦|æ¸¬å®šã™ã‚‹|æ¸¬å®šã—ãŸ/.test(answer),
    // ç†ç”±ã®èª¬æ˜ãŒã‚ã‚‹ã‹
    hasReason: /ã‹ã‚‰|ãŸã‚|ã®ã§|ç†ç”±|ãã£ã‹ã‘/.test(answer),
    // å›°é›£ã®èª¬æ˜ãŒã‚ã‚‹ã‹ï¼ˆã‚ˆã‚ŠåŒ…æ‹¬çš„ã«ï¼‰
    hasDifficulty: /å›°ã£ãŸ|å¤§å¤‰|é›£ã—ã‹ã£ãŸ|ã†ã¾ãã„ã‹ãª|å¤±æ•—|å•é¡Œ|èª²é¡Œ|è‹¦åŠ´|æ­»ã‚“ã§|ã ã‚|æ‚ªã/.test(answer),
    // å…·ä½“ä¾‹ãŒã‚ã‚‹ã‹
    hasExample: /ä¾‹ãˆã°|å…·ä½“çš„ã«|ã‚ˆã†ãª|ãªã©/.test(answer),
    // äººç‰©ã®è¨€åŠãŒã‚ã‚‹ã‹
    hasPerson: /å…ˆç”Ÿ|å‹é”|ä»²é–“|ã¿ã‚“ãª|ä¸€ç·’|æ¯|çˆ¶/.test(answer),
    // æ•°é‡ã®è¨€åŠãŒã‚ã‚‹ã‹
    hasQuantity: /\d+äºº|\d+å›|\d+å€‹/.test(answer),
    // æ„Ÿæƒ³ãƒ»æ„Ÿæƒ…ã®è¡¨ç¾ãŒã‚ã‚‹ã‹
    hasFeeling: /æ€ã£ãŸ|æ„Ÿã˜ãŸ|å¬‰ã—ã‹ã£ãŸ|æ¥½ã—ã‹ã£ãŸ|æ‚²ã—ã‹ã£ãŸ/.test(answer)
  };

  // è³ªå•ã«å¯¾ã—ã¦ä¸é©åˆ‡ãªå›ç­”ãƒ‘ã‚¿ãƒ¼ãƒ³
  const misalignedPatterns = [
    // æ™‚é–“ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«æ™‚é–“ã®æƒ…å ±ãŒãªã„
    (questionTypes.time && !answerChecks.hasTime && answer.length > 15),
    // æ–¹æ³•ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«æ–¹æ³•ã®èª¬æ˜ãŒãªã„ï¼ˆæ„Ÿæƒ³ãƒ»æ„è¦‹ã ã‘ã®å ´åˆï¼‰
    (questionTypes.method && !answerChecks.hasMethod && answer.length > 15 &&
     (answer.includes('é‡è¦') || answer.includes('å¤§åˆ‡') || answer.includes('æ€ã„ã¾ã™') || answer.includes('ã¨æ€ã†'))),
    // ç†ç”±ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«ç†ç”±ã®èª¬æ˜ãŒãªã„
    (questionTypes.reason && !answerChecks.hasReason && answer.length > 15),
    // å›°é›£ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«å›°é›£ã®èª¬æ˜ãŒãªã„ï¼ˆæ¥½ã—ã„ãƒ»å¬‰ã—ã„è©±ã ã‘ã®å ´åˆï¼‰
    (questionTypes.difficulty && !answerChecks.hasDifficulty &&
     (answer.includes('æ¥½ã—ã‹ã£ãŸ') || answer.includes('å¬‰ã—ã‹ã£ãŸ') || answer.includes('é¢ç™½ã‹ã£ãŸ'))),
    // äººç‰©ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«äººç‰©ã®è¨€åŠãŒãªã„
    (questionTypes.person && !answerChecks.hasPerson && answer.length > 10),
    // æ•°é‡ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«æ•°é‡ã®è¨€åŠãŒãªã„
    (questionTypes.quantity && !answerChecks.hasQuantity && answer.length > 10),
    // è³ªå•ã¨å…¨ãé–¢ä¿‚ãªã„å†…å®¹ï¼ˆå¿—æœ›ç†ç”±ãªã©ã‚’çªç„¶è©±ã—å§‹ã‚ã‚‹ï¼‰
    (answer.includes('æ˜å’Œ') && !question.includes('æ˜å’Œ') && !question.includes('å¿—æœ›')),
    // ã€Œã¯ã„ã€ã€Œã„ã„ãˆã€ã ã‘ã®çŸ­ã™ãã‚‹å›ç­”ï¼ˆè©³ç´°ã‚’æ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
    ((answer === 'ã¯ã„' || answer === 'ã„ã„ãˆ' || answer.length < 10) && 
     (question.includes('è©³ã—ã') || question.includes('èª¬æ˜') || question.includes('æ•™ãˆã¦')))
  ];

  // ã„ãšã‚Œã‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«è©²å½“ã™ã‚Œã°trueï¼ˆã‹ã¿åˆã£ã¦ã„ãªã„ï¼‰
  return misalignedPatterns.some(pattern => pattern);
}

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
const testCases = [
  {
    name: "æ™‚é–“ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«ç†ç”±ã‚’ç­”ãˆã‚‹",
    question: "ã©ã‚Œãã‚‰ã„æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã‹ï¼Ÿ",
    answer: "æœæ—©ãå®¶ã‚’å‡ºãŸã®ã¯ã€é…åˆ»ã—ãŸããªã‹ã£ãŸã‹ã‚‰ã§ã™ã€‚",
    expected: true
  },
  {
    name: "å›°é›£ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«æ¥½ã—ã‹ã£ãŸã“ã¨ã‚’ç­”ãˆã‚‹",
    question: "ãƒ¡ãƒ€ã‚«ã®é£¼è‚²ã§ä¸€ç•ªå›°ã£ãŸã“ã¨ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ",
    answer: "ãƒ¡ãƒ€ã‚«ã®èµ¤ã¡ã‚ƒã‚“ãŒç”Ÿã¾ã‚ŒãŸæ™‚ã¯ã¨ã¦ã‚‚å¬‰ã—ã‹ã£ãŸã§ã™ã€‚ã¿ã‚“ãªã§è¦³å¯Ÿã—ã¦æ¥½ã—ã‹ã£ãŸã§ã™ã€‚",
    expected: true
  },
  {
    name: "æ–¹æ³•ã‚’èã‹ã‚Œã¦ã„ã‚‹ã®ã«æ„Ÿæƒ³ã ã‘ç­”ãˆã‚‹",
    question: "pHå€¤ã®æ¸¬å®šã¯ã©ã®ã‚ˆã†ãªæ–¹æ³•ã§è¡Œã„ã¾ã—ãŸã‹ï¼Ÿ",
    answer: "pHå€¤ã®æ¸¬å®šã¯ã¨ã¦ã‚‚é‡è¦ã ã¨æ€ã„ã¾ã™ã€‚",
    expected: true
  },
  {
    name: "æ™‚é–“ã®è³ªå•ã«é©åˆ‡ã«å›ç­”",
    question: "ã©ã‚Œãã‚‰ã„æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã‹ï¼Ÿ",
    answer: "30åˆ†ãã‚‰ã„ã‹ã‹ã‚Šã¾ã—ãŸã€‚",
    expected: false
  },
  {
    name: "å›°é›£ã®è³ªå•ã«é©åˆ‡ã«å›ç­”",
    question: "ãƒ¡ãƒ€ã‚«ã®é£¼è‚²ã§ä¸€ç•ªå›°ã£ãŸã“ã¨ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ",
    answer: "æ°´è³ªç®¡ç†ãŒé›£ã—ãã¦ã€æœ€åˆã¯ãƒ¡ãƒ€ã‚«ãŒæ­»ã‚“ã§ã—ã¾ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚",
    expected: false
  },
  {
    name: "æ–¹æ³•ã®è³ªå•ã«é©åˆ‡ã«å›ç­”",
    question: "pHå€¤ã®æ¸¬å®šã¯ã©ã®ã‚ˆã†ãªæ–¹æ³•ã§è¡Œã„ã¾ã—ãŸã‹ï¼Ÿ",
    answer: "å°‚ç”¨ã®è©¦é¨“ç´™ã‚’ä½¿ã£ã¦ã€æ¯æ—¥åŒã˜æ™‚é–“ã«æ¸¬å®šã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚",
    expected: false
  }
];

console.log("ğŸ§ª ã‹ã¿åˆã‚ãªã„å›ç­”æ¤œå‡ºãƒ†ã‚¹ãƒˆé–‹å§‹\n");

testCases.forEach((testCase, index) => {
  const result = checkAnswerAlignment(testCase.question, testCase.answer);
  const status = result === testCase.expected ? "âœ… æˆåŠŸ" : "âŒ å¤±æ•—";
  
  console.log(`ãƒ†ã‚¹ãƒˆ ${index + 1}: ${testCase.name}`);
  console.log(`è³ªå•: "${testCase.question}"`);
  console.log(`å›ç­”: "${testCase.answer}"`);
  console.log(`æœŸå¾…å€¤: ${testCase.expected ? "ã‹ã¿åˆã‚ãªã„" : "é©åˆ‡"}`);
  console.log(`å®Ÿéš›: ${result ? "ã‹ã¿åˆã‚ãªã„" : "é©åˆ‡"}`);
  console.log(`çµæœ: ${status}\n`);
});

console.log("ğŸ¯ ãƒ†ã‚¹ãƒˆå®Œäº†");